# Phase 4 - Unity Setup Guide
## Synty Sidekick Character Integration

This guide walks you through implementing Phase 4 in Unity Editor after the code changes have been applied.

---

## Prerequisites

✅ Phase 3 completed and working
✅ All Phase 4 scripts created:
- `SidekickPartSwapper.cs`
- Updated `PartData.cs`
- Updated `CharacterPartManager.cs`
- Updated `PartPickup.cs`

✅ Synty Sidekick Characters package imported (if using Sidekick)

---

## Step 1: Sidekick Character Setup (If Using Sidekick)

### 1.1 Create Base Character

1. **Open Sidekick Character Tool**
   - Go to `Synty > Sidekick Character Tool` in the top menu bar

2. **Create New Character**
   - Click "New Character"
   - Name: `BaseCharacter`
   - Type: Humanoid
   - Gender: Your choice

3. **Configure Base State (Nearly Naked)**
   - Head: None or Basic_Hair_01
   - Torso: Underwear_Basic
   - Arms: None (bare arms)
   - Hands: None (bare hands)
   - Legs: Underwear_Basic
   - Feet: None or Basic_Shoes

4. **Set Colors**
   - Skin Color: Default
   - Primary: Gray (#808080)
   - Secondary: Dark Gray (#404040)

5. **Export as Prefab**
   - Location: `Assets/Prefabs/Player/BaseCharacter.prefab`
   - Include Components: ✓

### 1.2 Configure Sidekick Component

Select the BaseCharacter prefab and configure:

```
SidekickCharacter Component:
├── Character ID: "base_character"
├── Enable Runtime Swap: ✓ (CRITICAL!)
├── Part Categories: All enabled
├── Optimization Mode: Mobile
└── Allow Part Removal: ✓
```

---

## Step 2: Update Player Prefab

### 2.1 Add Components

1. **Open Player Prefab**
   - `Assets/Prefabs/Player/Player.prefab`

2. **Add SidekickPartSwapper Component**
   - Select Player root GameObject
   - Add Component > `SidekickPartSwapper`
   - Configure:
     ```
     Use Sidekick Integration: ✓ (if using Sidekick)
     Sidekick Character: [Drag BaseCharacter reference]
     Head Slot: [Existing head slot transform]
     Arms Slot: [Existing arms slot transform]
     Torso Slot: [Existing torso slot transform]
     Legs Slot: [Existing legs slot transform]
     ```

3. **Update CharacterPartManager**
   - Should auto-find `SidekickPartSwapper` on same GameObject
   - Verify `Part Swapper` field is assigned in Inspector

### 2.2 Integrate BaseCharacter (If Using Sidekick)

**Option A: Replace Visual**
1. Delete existing capsule/dummy visual child
2. Drag `BaseCharacter` prefab as child of Player
3. Position at (0, 0, 0) local

**Option B: Keep Dummy Fallback**
1. Keep existing dummy setup
2. Add BaseCharacter as child
3. System will use Sidekick if available, dummy if not

### 2.3 Update Animator (If Using Sidekick)

```
Player Prefab Hierarchy:
├── Player (Root)
│   ├── PlayerController
│   ├── PlayerStats
│   ├── CharacterPartManager ← Update this
│   ├── SidekickPartSwapper ← New component
│   ├── CombatManager
│   ├── DamageHandler
│   └── BaseCharacter (Sidekick) ← New child
│       ├── SidekickCharacter
│       ├── Animator ← Use this for animations
│       └── [Mesh generated by Sidekick]
```

---

## Step 3: Update PartData Assets

For each of the 12 PartData assets in `Assets/Data/Parts/`:

### 3.1 Head Parts

**Part_Head_Common.asset:**
```
Sidekick Part ID: MSC_Head_Basic_01
Drop Mesh ID: (optional)
Rarity Material: Mat_Common_Glow
```

**Part_Head_Rare.asset:**
```
Sidekick Part ID: MSC_Head_Armor_Light_01
Drop Mesh ID: (optional)
Rarity Material: Mat_Rare_Glow
```

**Part_Head_Epic.asset:**
```
Sidekick Part ID: MSC_Head_Armor_Heavy_01
Drop Mesh ID: (optional)
Rarity Material: Mat_Epic_Glow
```

### 3.2 Repeat for Arms, Torso, Legs

Update the remaining 9 PartData assets following the same pattern.

**Reference:** See `Assets/Data/Parts/PartIDMapping.txt` for complete ID list.

---

## Step 4: Create Rarity Materials

### 4.1 Create Materials Folder

Create folder: `Assets/Materials/Parts/`

### 4.2 Create Common Material

1. **Create Material**
   - Right-click in Parts folder
   - Create > Material
   - Name: `Mat_Common_Glow`

2. **Configure:**
   ```
   Shader: Universal Render Pipeline/Lit
   Base Map: White
   Base Color: Gray (#808080)
   Metallic: 0.2
   Smoothness: 0.3
   Emission: None
   ```

### 4.3 Create Rare Material

**Mat_Rare_Glow:**
```
Shader: Universal Render Pipeline/Lit
Base Map: White
Base Color: Blue (#4A90E2)
Metallic: 0.5
Smoothness: 0.6
Emission:
  ├── Enabled: ✓
  ├── Color: Blue (#4A90E2)
  └── Intensity: 0.5
```

### 4.4 Create Epic Material

**Mat_Epic_Glow:**
```
Shader: Universal Render Pipeline/Lit
Base Map: White
Base Color: Purple (#9B59B6)
Metallic: 0.7
Smoothness: 0.8
Emission:
  ├── Enabled: ✓
  ├── Color: Purple (#9B59B6)
  └── Intensity: 1.0
```

---

## Step 5: Find Actual Sidekick Part IDs

### 5.1 Browse Available Parts

1. **Open Character Tool**
   - `Synty > Sidekick Character Tool`

2. **Select Category**
   - Click "Head", "Arms", "Torso", or "Legs"

3. **Find Part IDs**
   - Browse available parts
   - Select a part and check Inspector
   - Note the exact ID string (case-sensitive)

### 5.2 Update PartIDMapping.txt

Update `Assets/Data/Parts/PartIDMapping.txt` with actual IDs from your package.

### 5.3 Apply to PartData Assets

Copy the IDs from mapping file to each PartData asset's "Sidekick Part ID" field.

---

## Step 6: Testing

### 6.1 Test Base Character

1. **Play Mode**
   - Start the game
   - Player should appear nearly naked (base character)

2. **Verify**
   - Character visible? ✓
   - Animations working? ✓
   - Performance good? ✓

### 6.2 Test First Part Pickup

1. **Spawn a Part**
   - Use debug menu or kill an enemy
   - Pick up a Common Head part

2. **Verify**
   - Part appears on character? ✓
   - No errors in console? ✓
   - Stats increase correctly? ✓
   - Frame rate stable? ✓

### 6.3 Test Full Armor Set

1. **Collect All Parts**
   - Get all 4 part types (Head, Arms, Torso, Legs)
   - Preferably Epic rarity

2. **Verify**
   - Character looks fully armored? ✓
   - All parts visible? ✓
   - Visual quality good? ✓
   - Animations still work? ✓

### 6.4 Check Console Logs

Look for:
```
✓ [SidekickPartSwapper] Sidekick integration enabled
✓ [CharacterPartManager] Equipped Epic Head using Sidekick: MSC_Head_Armor_Heavy_01
✓ [SidekickPartSwapper] Swapped Head to 'MSC_Head_Armor_Heavy_01'
```

**Or fallback mode:**
```
⚠ [SidekickPartSwapper] Using fallback mode
✓ [CharacterPartManager] Created fallback visual for Epic Head
```

---

## Step 7: Optimization (Optional)

### 7.1 Configure Quality Settings

```
Edit > Project Settings > Quality

Mobile Settings:
├── Texture Quality: Half Res
├── Shadow Distance: 20
├── Shadow Cascades: No Cascades
└── Anti Aliasing: Disabled
```

### 7.2 Sidekick Optimization

```
Synty > Sidekick Character Tool > Settings tab

Runtime Configuration:
├── Use Object Pooling: ✓
├── Auto Combine Meshes: After 2 seconds
├── Mobile Optimization: ✓
├── Max Bone Weights: 2
└── Texture Resolution: 512x512
```

---

## Fallback Mode (Without Sidekick)

If you don't have Sidekick package or want to test without it:

1. **Disable Sidekick Integration**
   ```
   SidekickPartSwapper Component:
   └── Use Sidekick Integration: ✗
   ```

2. **System will automatically:**
   - Use dummy visual system (colored primitives)
   - Apply rarity materials to primitives
   - Maintain all gameplay functionality

3. **Benefits:**
   - Test without Sidekick package
   - Faster iteration during development
   - Graceful degradation

---

## Troubleshooting

### Problem: "Part ID not found"

**Solution:**
1. Verify Sidekick Part ID is exact match (case-sensitive)
2. Check part exists in your Sidekick package version
3. Browse Character Creator to confirm available parts

### Problem: Character appears black/pink

**Solution:**
1. Check materials are assigned correctly
2. Verify shaders compatible with URP
3. Reimport Sidekick package if needed

### Problem: Parts not appearing after pickup

**Solution:**
1. Check SidekickCharacter component is active
2. Verify "Enable Runtime Swap" is checked ✓
3. Confirm part categories enabled in Sidekick settings
4. Check console for error messages

### Problem: Performance drops when equipping

**Solution:**
1. Disable mesh combining during gameplay
2. Reduce texture sizes in Sidekick settings
3. Use mobile optimization preset
4. Check draw calls (should be <50)

### Problem: Animations not playing

**Solution:**
1. Verify Animator is on BaseCharacter, not Player root
2. Check Avatar is set to Sidekick Humanoid
3. Confirm Animator Controller is assigned
4. Test with simple animation first

---

## Validation Checklist

Before moving to Phase 5, verify:

- [ ] Base character displays correctly
- [ ] Parts equip and show visually
- [ ] All 4 part types work (Head, Arms, Torso, Legs)
- [ ] All 3 rarities work (Common, Rare, Epic)
- [ ] Stats still apply correctly
- [ ] UI updates properly
- [ ] Drop system unchanged
- [ ] Wave system still works
- [ ] Performance acceptable (30+ FPS)
- [ ] No visual glitches
- [ ] Animations play correctly
- [ ] Console shows no errors

---

## Next Steps

Once Phase 4 is complete:
- **Phase 5:** Polish, VFX, Audio, and final optimizations
- **Mobile Build:** Test on actual Android device
- **Balance:** Adjust drop rates and stats based on playtesting

---

## Quick Reference

**Key Files:**
- Scripts: `Assets/Scripts/Parts/SidekickPartSwapper.cs`
- Data: `Assets/Data/Parts/PartIDMapping.txt`
- Materials: `Assets/Materials/Parts/Mat_*_Glow.mat`
- Prefabs: `Assets/Prefabs/Player/BaseCharacter.prefab`

**Key Components:**
- `SidekickPartSwapper` - Handles Sidekick API integration
- `CharacterPartManager` - Updated to use swapper
- `SidekickCharacter` - From Synty package (if available)

**Important Settings:**
- Enable Runtime Swap: ✓ (on SidekickCharacter)
- Use Sidekick Integration: ✓ (on SidekickPartSwapper)

---

*Phase 4 focuses on visual upgrade while maintaining all Phase 3 gameplay mechanics. The system gracefully falls back to dummy visuals if Sidekick is not available.*
